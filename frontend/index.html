<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monte Carlo Simulator</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ² Monte Carlo Simulator</h1>
            <p>Monte Carlo Simulation and Analysis</p>
        </div>

        <div class="content">
            <!-- Status Messages -->
            <div id="status" style="display: none;"></div>

            <!-- Step 1: Add Variables (JSON Only) -->
            <div class="step">
                <h2>Step 1: Add Variables (JSON Format)</h2>
                
                <!-- Collapsible Examples -->
                <div class="collapsible">
                    <div class="collapsible-header" onclick="toggleCollapsible(this)">
                        ğŸ“– Show Input Examples
                    </div>
                    <div class="collapsible-content">
                        <div class="example-section">
                            <h4>å­—æ®µè¯´æ˜</h4>
                            <div class="help-text">
                                <strong>å¿…å¡«å­—æ®µ:</strong>
                                <ul style="margin: 8px 0; padding-left: 20px;">
                                    <li><code>type</code>: "data" (ä½¿ç”¨å®æµ‹æ•°æ®) æˆ– "params" (ä½¿ç”¨ç»Ÿè®¡å‚æ•°)</li>
                                    <li><code>distribution</code>: åˆ†å¸ƒç±»å‹ï¼ˆè§ä¸‹æ–¹æ”¯æŒçš„9ç§åˆ†å¸ƒï¼‰</li>
                                </ul>
                                <strong>å¯é€‰å­—æ®µ:</strong>
                                <ul style="margin: 8px 0; padding-left: 20px;">
                                    <li><code>min_limit</code>, <code>max_limit</code>: é™åˆ¶é‡‡æ ·èŒƒå›´</li>
                                </ul>
                                <strong>Data ç±»å‹éœ€è¦:</strong> <code>values</code> (æ•°ç»„)
                                <br>
                                <strong>Params ç±»å‹éœ€è¦:</strong> æ ¹æ®åˆ†å¸ƒç±»å‹ä¸åŒè€Œä¸åŒï¼ˆè§ä¸‹æ–¹å„åˆ†å¸ƒå‚æ•°è¯´æ˜ï¼‰
                            </div>

                            <h4>æ”¯æŒçš„9ç§æ¦‚ç‡åˆ†å¸ƒ</h4>
                            <div class="help-text" style="background: #f8f9fa; padding: 12px; border-radius: 4px; margin-bottom: 15px;">
                                <table style="width: 100%; border-collapse: collapse;">
                                    <tr style="border-bottom: 1px solid #ddd;">
                                        <th style="text-align: left; padding: 8px;">åˆ†å¸ƒç±»å‹</th>
                                        <th style="text-align: left; padding: 8px;">å‚æ•°</th>
                                        <th style="text-align: left; padding: 8px;">é€‚ç”¨åœºæ™¯</th>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px;"><code>normal</code></td>
                                        <td style="padding: 8px;">mean, std</td>
                                        <td style="padding: 8px;">æµ‹é‡è¯¯å·®ã€è‡ªç„¶ç°è±¡</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px;"><code>t</code></td>
                                        <td style="padding: 8px;">mean, std, df</td>
                                        <td style="padding: 8px;">å°æ ·æœ¬ã€é‡å°¾æ•°æ®</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px;"><code>lognormal</code></td>
                                        <td style="padding: 8px;">mean, std (å¯¹æ•°ç©ºé—´)</td>
                                        <td style="padding: 8px;">ä»·æ ¼ã€æ”¶å…¥ã€èµ„äº§</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px;"><code>uniform</code></td>
                                        <td style="padding: 8px;">min, max</td>
                                        <td style="padding: 8px;">ç­‰å¯èƒ½ã€ç¼ºä¹ä¿¡æ¯</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px;"><code>triangular</code></td>
                                        <td style="padding: 8px;">min, mode, max</td>
                                        <td style="padding: 8px;">ä¸“å®¶ä¼°è®¡ã€é¡¹ç›®ç®¡ç†</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px;"><code>beta</code></td>
                                        <td style="padding: 8px;">alpha, beta, min, max</td>
                                        <td style="padding: 8px;">ç™¾åˆ†æ¯”ã€æ¦‚ç‡ã€å®Œæˆåº¦</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px;"><code>gamma</code></td>
                                        <td style="padding: 8px;">shape, scale</td>
                                        <td style="padding: 8px;">ç­‰å¾…æ—¶é—´ã€å¯¿å‘½åˆ†æ</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px;"><code>exponential</code></td>
                                        <td style="padding: 8px;">scale (æˆ– rate)</td>
                                        <td style="padding: 8px;">æ•…éšœæ—¶é—´ã€æœåŠ¡æ—¶é—´</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px;"><code>weibull</code></td>
                                        <td style="padding: 8px;">shape, scale</td>
                                        <td style="padding: 8px;">å¯é æ€§åˆ†æã€é£é€Ÿ</td>
                                    </tr>
                                </table>
                            </div>

                            <h4>ç¤ºä¾‹ 1: t åˆ†å¸ƒ (Student's t)</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'jsonInput')">ğŸ“‹ Copy</button>
<pre><code>{
  "C": {
    "type": "data",
    "values": [1255.80,1168.12, 1275.73, 1164.53, 1119.68, 1123.21, 1078.96, 955.83, 1309.05],
    "distribution": "t",
    "min_limit": 500
  },
  "P1": {
    "type": "data",
    "values": [43.90, 80.05, 60.24, 90.22, 109.52, 84.03, 101.04, 84.60, 73.26, 62.71, 80.72, 85.11, 65.42, 51.02, 133.96,
224.57, 96.98, 55.98, 112.91, 158.73, 63.67, 53.70, 45.55, 89.25],
    "distribution": "t",
    "min_limit": 0.1
  }
}</code></pre>
                            </div>

                            <h4>ç¤ºä¾‹ 2: æ­£æ€åˆ†å¸ƒ (Normal)</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'jsonInput')">ğŸ“‹ Copy</button>
<pre><code>{
  "æµ‹é‡å€¼": {
    "type": "data",
    "values": [10.5, 11.2, 9.8, 10.1, 10.7, 11.0, 10.3],
    "distribution": "normal"
  },
  "ç†è®ºå€¼": {
    "type": "params",
    "mean": 100,
    "std": 5,
    "distribution": "normal"
  }
}</code></pre>
                            </div>

                            <h4>ç¤ºä¾‹ 3: å¯¹æ•°æ­£æ€åˆ†å¸ƒ (Lognormal)</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'jsonInput')">ğŸ“‹ Copy</button>
<pre><code>{
  "èµ„äº§ä»·å€¼": {
    "type": "params",
    "mean": 13.8,
    "std": 0.5,
    "distribution": "lognormal"
  }
}</code></pre>
                            <div class="help-text">æ³¨æ„ï¼šmean å’Œ std æ˜¯å¯¹æ•°ç©ºé—´çš„å‚æ•°</div>
                            </div>

                            <h4>ç¤ºä¾‹ 4: å‡åŒ€åˆ†å¸ƒ (Uniform)</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'jsonInput')">ğŸ“‹ Copy</button>
<pre><code>{
  "æŠ˜æ‰£ç‡": {
    "type": "params",
    "min": 0.05,
    "max": 0.15,
    "distribution": "uniform"
  }
}</code></pre>
                            </div>

                            <h4>ç¤ºä¾‹ 5: ä¸‰è§’åˆ†å¸ƒ (Triangular)</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'jsonInput')">ğŸ“‹ Copy</button>
<pre><code>{
  "é¡¹ç›®å·¥æœŸ": {
    "type": "params",
    "min": 10,
    "mode": 15,
    "max": 25,
    "distribution": "triangular"
  }
}</code></pre>
                            <div class="help-text">é€‚ç”¨äºæœ‰æœ€å°å€¼ã€æœ€å¯èƒ½å€¼ã€æœ€å¤§å€¼çš„ä¸“å®¶ä¼°è®¡</div>
                            </div>

                            <h4>ç¤ºä¾‹ 6: Beta åˆ†å¸ƒ</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'jsonInput')">ğŸ“‹ Copy</button>
<pre><code>{
  "å®Œæˆç‡": {
    "type": "params",
    "alpha": 2,
    "beta": 5,
    "min": 0,
    "max": 1,
    "distribution": "beta"
  }
}</code></pre>
                            <div class="help-text">é€‚ç”¨äºæœ‰ç•Œå˜é‡ï¼Œå¦‚ç™¾åˆ†æ¯”ã€æ¦‚ç‡ç­‰</div>
                            </div>

                            <h4>ç¤ºä¾‹ 7: Gamma åˆ†å¸ƒ</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'jsonInput')">ğŸ“‹ Copy</button>
<pre><code>{
  "ç­‰å¾…æ—¶é—´": {
    "type": "params",
    "shape": 2,
    "scale": 3,
    "distribution": "gamma"
  }
}</code></pre>
                            </div>

                            <h4>ç¤ºä¾‹ 8: æŒ‡æ•°åˆ†å¸ƒ (Exponential)</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'jsonInput')">ğŸ“‹ Copy</button>
<pre><code>{
  "æ•…éšœæ—¶é—´": {
    "type": "params",
    "scale": 100,
    "distribution": "exponential"
  }
}</code></pre>
                            <div class="help-text">ä¹Ÿå¯ä»¥ä½¿ç”¨ rate å‚æ•°ï¼ˆrate = 1/scaleï¼‰</div>
                            </div>

                            <h4>ç¤ºä¾‹ 9: Weibull åˆ†å¸ƒ</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'jsonInput')">ğŸ“‹ Copy</button>
<pre><code>{
  "å…ƒä»¶å¯¿å‘½": {
    "type": "params",
    "shape": 1.5,
    "scale": 5000,
    "distribution": "weibull"
  }
}</code></pre>
                            </div>

                            <h4>ç¤ºä¾‹ 10: æ··åˆä½¿ç”¨å¤šç§åˆ†å¸ƒ</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'jsonInput')">ğŸ“‹ Copy</button>
<pre><code>{
  "æ”¶å…¥": {
    "type": "params",
    "mean": 13.8,
    "std": 0.5,
    "distribution": "lognormal"
  },
  "æˆæœ¬": {
    "type": "params",
    "mean": 100000,
    "std": 5000,
    "distribution": "normal"
  },
  "æŠ˜æ‰£": {
    "type": "params",
    "min": 0.05,
    "max": 0.15,
    "distribution": "uniform"
  },
  "å®Œæˆåº¦": {
    "type": "params",
    "alpha": 8,
    "beta": 2,
    "min": 0,
    "max": 1,
    "distribution": "beta"
  }
}</code></pre>
                            </div>

                            <h4>ç¤ºä¾‹ 11: å¸¦é™å€¼çº¦æŸ</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'jsonInput')">ğŸ“‹ Copy</button>
<pre><code>{
  "æ¸©åº¦": {
    "type": "params",
    "mean": 20,
    "std": 3,
    "distribution": "normal",
    "min_limit": 15,
    "max_limit": 25
  },
  "å‹åŠ›": {
    "type": "params",
    "mean": 100,
    "std": 5,
    "distribution": "normal",
    "min_limit": 85,
    "max_limit": 115
  }
}</code></pre>
                            <div class="help-text">min_limit å’Œ max_limit ä¼šé™åˆ¶é‡‡æ ·èŒƒå›´</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="jsonInput">JSON Variable Definition</label>
                    <textarea id="jsonInput" placeholder='Paste JSON format variable definition...'></textarea>
                    <div class="help-text">Paste JSON format variable definition, click "Show Input Examples" above to view examples</div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <button onclick="addVariablesFromJson()">Add Variables from JSON</button>
                    <div id="addVariableStatus" style="display: none; flex: 1; min-width: 300px;"></div>
                </div>

                <div id="variableList" class="variable-list" style="display: none;">
                    <strong>Added Variables:</strong>
                    <div id="variableItems"></div>
                </div>
            </div>

            <!-- Step 2: Define Function -->
            <div class="step">
                <h2>Step 2: Define Function</h2>

                <!-- Collapsible Simple Formula Examples -->
                <div class="collapsible" id="simpleFormulaExamples">
                    <div class="collapsible-header" onclick="toggleCollapsible(this)">
                        ğŸ“– Show Simple Formula Examples
                    </div>
                    <div class="collapsible-content">
                        <div class="example-section">
                            <h4>ç¤ºä¾‹ 1: ç™¾åˆ†æ¯”è®¡ç®—</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'formula')">ğŸ“‹ Copy</button>
<pre><code>1 - P1 / C</code></pre>
                            </div>
                            <div class="help-text">è®¡ç®—å‰©ä½™æ¯”ä¾‹ï¼ˆå¸¸ç”¨ï¼‰</div>

                            <h4>ç¤ºä¾‹ 2: åŸºæœ¬ç®—æœ¯è¿ç®—</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'formula')">ğŸ“‹ Copy</button>
<pre><code>A + B</code></pre>
                            </div>
                            <div class="help-text">ä¸¤ä¸ªå˜é‡ç›¸åŠ </div>

                            <h4>ç¤ºä¾‹ 3: ä¹˜æ³•å’Œé™¤æ³•</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'formula')">ğŸ“‹ Copy</button>
<pre><code>æ”¶å…¥ * æŠ˜æ‰£ç‡</code></pre>
                            </div>
                            <div class="help-text">è®¡ç®—æŠ˜æ‰£åçš„æ”¶å…¥</div>

                            <h4>ç¤ºä¾‹ 4: å¤åˆè¿ç®—</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'formula')">ğŸ“‹ Copy</button>
<pre><code>(æ”¶å…¥ - æˆæœ¬) / æ”¶å…¥</code></pre>
                            </div>
                            <div class="help-text">è®¡ç®—åˆ©æ¶¦ç‡</div>

                            <h4>ç¤ºä¾‹ 5: åŠ æƒå¹³å‡</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'formula')">ğŸ“‹ Copy</button>
<pre><code>æ¸©åº¦ * 0.6 + å‹åŠ› * 0.4</code></pre>
                            </div>
                            <div class="help-text">ä¸¤ä¸ªå˜é‡çš„åŠ æƒæ±‚å’Œ</div>

                            <h4>ç¤ºä¾‹ 6: å¹‚è¿ç®—</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'formula')">ğŸ“‹ Copy</button>
<pre><code>A**2 + B**2</code></pre>
                            </div>
                            <div class="help-text">å¹³æ–¹å’Œè®¡ç®—</div>

                            <h4>ç¤ºä¾‹ 7: å¤šå˜é‡ç»„åˆ</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'formula')">ğŸ“‹ Copy</button>
<pre><code>(A + B) * C - D</code></pre>
                            </div>
                            <div class="help-text">å¤šä¸ªå˜é‡çš„å¤åˆè®¡ç®—</div>

                            <h4>ç¤ºä¾‹ 8: æ•°å­¦å‡½æ•° - ä¸‰è§’å‡½æ•°</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'formula')">ğŸ“‹ Copy</button>
<pre><code>sin(å¼§åº¦) + cos(å¼§åº¦)</code></pre>
                            </div>
                            <div class="help-text">ä½¿ç”¨ä¸‰è§’å‡½æ•°ï¼ˆç”¨å¼§åº¦ï¼‰</div>

                            <h4>ç¤ºä¾‹ 9: æ•°å­¦å‡½æ•° - æŒ‡æ•°å’Œå¯¹æ•°</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'formula')">ğŸ“‹ Copy</button>
<pre><code>exp(A) + log(B)</code></pre>
                            </div>
                            <div class="help-text">æŒ‡æ•°å‡½æ•°å’Œè‡ªç„¶å¯¹æ•°</div>

                            <h4>ç¤ºä¾‹ 10: æ•°å­¦å‡½æ•° - å¹³æ–¹æ ¹</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'formula')">ğŸ“‹ Copy</button>
<pre><code>sqrt(A**2 + B**2)</code></pre>
                            </div>
                            <div class="help-text">è®¡ç®—å‘é‡é•¿åº¦</div>

                            <div class="help-text" style="margin-top: 15px;">
                                <strong>æ”¯æŒçš„è¿ç®—ç¬¦:</strong> +ï¼ˆåŠ ï¼‰ã€-ï¼ˆå‡ï¼‰ã€*ï¼ˆä¹˜ï¼‰ã€/ï¼ˆé™¤ï¼‰ã€**ï¼ˆå¹‚ï¼‰ã€()ï¼ˆæ‹¬å·ï¼‰
                                <br>
                                <strong>æ”¯æŒçš„æ•°å­¦å‡½æ•°:</strong> sin, cos, tan, exp, log, log10, sqrt, abs, pow
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Collapsible Advanced Formula Examples -->
                <div class="collapsible" id="advancedFormulaExamples" style="display: none;">
                    <div class="collapsible-header" onclick="toggleCollapsible(this)">
                        ğŸ“– Show Advanced Formula Examples
                    </div>
                    <div class="collapsible-content">
                        <div class="example-section">
                            <h4>ç¤ºä¾‹ 1: ç®€å•ç®—æœ¯è¿ç®—</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'customFunction')">ğŸ“‹ Copy</button>
<pre><code>def custom_formula(vars):
    """ç®€å•çš„åŠ æƒæ±‚å’Œ"""
    return vars['æ¸©åº¦'] * 0.6 + vars['å‹åŠ›'] * 0.4</code></pre>
                            </div>

                            <h4>ç¤ºä¾‹ 2: ä½¿ç”¨ NumPy æ•°å­¦å‡½æ•°</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'customFunction')">ğŸ“‹ Copy</button>
<pre><code>def custom_formula(vars):
    """ä½¿ç”¨æ•°å­¦å‡½æ•°è®¡ç®—"""
    import numpy as np
    A = vars['var_A']
    B = vars['var_B']
    return np.sqrt(A**2 + B**2)</code></pre>
                            </div>

                            <h4>ç¤ºä¾‹ 3: æ¡ä»¶åˆ¤æ–­</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'customFunction')">ğŸ“‹ Copy</button>
<pre><code>def custom_formula(vars):
    """æ ¹æ®æ¡ä»¶è®¡ç®—ä¸åŒç»“æœ"""
    import numpy as np
    temp = vars['æ¸©åº¦']
    press = vars['å‹åŠ›']
    # æ¸©åº¦å¤§äº20æ—¶ç”¨ä¹˜æ³•ï¼Œå¦åˆ™ç”¨åŠ æ³•
    return np.where(temp > 20, temp * press, temp + press)</code></pre>
                            </div>

                            <h4>ç¤ºä¾‹ 4: å·¥ç¨‹è®¡ç®—å…¬å¼</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'customFunction')">ğŸ“‹ Copy</button>
<pre><code>def custom_formula(vars):
    """ç†æƒ³æ°”ä½“çŠ¶æ€æ–¹ç¨‹ PV = nRT"""
    import numpy as np
    T = vars['æ¸©åº¦']  # æ¸©åº¦ (æ‘„æ°åº¦)
    P = vars['å‹åŠ›']  # å‹åŠ› (Pa)
    F = vars['æµé‡']  # æµé‡
    R = 8.314  # æ°”ä½“å¸¸æ•°
    # è½¬æ¢ä¸ºå¼€å°”æ–‡æ¸©åº¦
    T_kelvin = T + 273.15
    return (P * F) / (T_kelvin * R)</code></pre>
                            </div>

                            <h4>ç¤ºä¾‹ 5: å¤šæ­¥éª¤å¤æ‚è®¡ç®—</h4>
                            <div class="example-code">
                                <button class="copy-btn" onclick="copyExample(this, 'customFunction')">ğŸ“‹ Copy</button>
<pre><code>def custom_formula(vars):
    """åˆ†æ­¥éª¤çš„å¤æ‚è®¡ç®—ç¤ºä¾‹"""
    import numpy as np
    
    # ç¬¬ä¸€æ­¥ï¼šæ•°æ®æ ‡å‡†åŒ–
    A_normalized = (vars['var_A'] - 100) / 10
    B_normalized = (vars['var_B'] - 50) / 5
    
    # ç¬¬äºŒæ­¥ï¼šç»„åˆè®¡ç®—
    combined = A_normalized * B_normalized
    
    # ç¬¬ä¸‰æ­¥ï¼šSigmoid å˜æ¢
    result = np.exp(combined) / (1 + np.exp(combined))
    
    return result</code></pre>
                            </div>

                            <div class="help-text" style="margin-top: 15px;">
                                <strong>å¯ç”¨çš„æ•°å­¦å‡½æ•°:</strong> numpy (as np), sin, cos, tan, exp, log, log10, ln, sqrt, abs, pow
                            </div>
                        </div>
                    </div>
                </div>

                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="simpleFormula" name="formulaType" value="simple" checked>
                        <label for="simpleFormula">Simple Formula</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="advancedFormula" name="formulaType" value="advanced">
                        <label for="advancedFormula">Advanced (Python Function)</label>
                    </div>
                </div>

                <div id="simpleFormulaDiv">
                    <div class="form-group">
                        <label for="formula">Simple Formula</label>
                        <input type="text" id="formula" placeholder="e.g., 1 - P1 / C">
                        <div class="help-text">Use variable names directly in the formula</div>
                    </div>
                </div>

                <div id="advancedFormulaDiv" style="display: none;">
                    <div class="form-group">
                        <label for="customFunction">Custom Python Function</label>
                        <textarea id="customFunction" placeholder="def custom_formula(vars):&#10;    import numpy as np&#10;    return vars['var_A'] + vars['var_B']"></textarea>
                        <div class="help-text">Function must be named 'custom_formula' and accept 'vars' dict parameter</div>
                    </div>
                </div>

                <div class="inline-fields">
                    <div class="form-group">
                        <label for="resultName">Result Name</label>
                        <input type="text" id="resultName" value="result">
                    </div>
                    <div class="form-group">
                        <label for="nSamples">Number of Samples</label>
                        <input type="number" id="nSamples" value="1000000" min="1000">
                    </div>
                    <div class="form-group">
                        <label for="cdfDegree">CDF Fit Degree</label>
                        <input type="number" id="cdfDegree" value="8" min="1" max="30">
                        <div class="help-text">Polynomial fit degree (1-30)</div>
                    </div>
                </div>

                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <button onclick="runSimulation()">Run Simulation</button>
                    <div id="simulationStatus" style="display: none; flex: 1; min-width: 300px;"></div>
                </div>
            </div>

            <!-- Step 3: Generate Charts -->
            <div class="step">
                <h2>Step 3: Generate Charts</h2>
                
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="chartResultPlot" value="result_plot" checked>
                        <label for="chartResultPlot">Result Distribution Plot</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="chartVarDist" value="var_distributions">
                        <label for="chartVarDist">Variable Distributions</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="chartPareto" value="pareto">
                        <label for="chartPareto">Pareto Chart</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="chartTornado" value="tornado">
                        <label for="chartTornado">Tornado Chart</label>
                    </div>
                </div>

                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <button onclick="generateCharts()">Generate Selected Charts</button>
                    <div id="chartStatus" style="display: none; flex: 1; min-width: 300px;"></div>
                </div>

                <div id="chartResults" class="result-container" style="display: none;"></div>
            </div>

            <!-- Step 4: Analysis & Download -->
            <div class="step">
                <h2>Step 4: Analysis & Download</h2>
                
                <div class="help-text" style="margin-bottom: 15px;">
                    Generate analysis report and download simulation data
                </div>

                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <button onclick="generateReport()">Generate Report</button>
                    
                    <!-- ä¸‹è½½æŒ‰é’®ä¸‹æ‹‰èœå• -->
                    <div style="position: relative;">
                        <button id="downloadBtn" onclick="toggleDownloadMenu()" style="background: #52A574; display: flex; align-items: center; gap: 8px;">
                            ğŸ“¥ Download Data
                            <span style="font-size: 0.8em;">â–¼</span>
                        </button>
                        <div id="downloadMenu" class="dropdown-menu" style="display: none;">
                            <a href="#" onclick="downloadCSV(); return false;">ğŸ“„ Raw Data (CSV)</a>
                            <a href="#" onclick="downloadJSON(); return false;">ğŸ“‹ Raw Data (JSON)</a>
                            <a href="#" onclick="downloadReport(); return false;">ğŸ“Š Analysis Report</a>
                            <a href="#" onclick="downloadFull(); return false;">ğŸ“¦ Full Report with Charts</a>
                        </div>
                    </div>
                    
                    <div id="reportStatus" style="display: none; flex: 1; min-width: 300px;"></div>
                </div>

                <div id="reportResult" class="result-container" style="display: none;"></div>
            </div>

            <!-- Reset Button -->
            <div class="step">
                <h2>Reset Simulator</h2>
                <button onclick="resetSimulator()" style="background: #D64949;">Reset All Data</button>
            </div>
        </div>
    </div>

    <script src="js/main.js"></script>
</body>
</html>
